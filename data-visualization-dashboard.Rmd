---
title: "Data Visualization Dashboard"
author: "Your Name"
date: "`r Sys.Date()`"
output:
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    theme: yeti
    source_code: embed
---

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(plotly)
library(DT)
library(viridis)

# Load your data
data <- mtcars %>%
  rownames_to_column("car_name") %>%
  mutate(
    am = factor(am, labels = c("Automatic", "Manual")),
    cyl = factor(cyl),
    vs = factor(vs, labels = c("V-shaped", "Straight"))
  )
```

# Overview

## Column {data-width=300}

### Key Metrics

```{r}
valueBox(
  nrow(data),
  icon = "fa-database",
  color = "primary",
  caption = "Total Records"
)
```

### Average MPG

```{r}
avg_mpg <- round(mean(data$mpg), 1)
valueBox(
  avg_mpg,
  icon = "fa-car",
  color = "success",
  caption = "Average MPG"
)
```

### Transmission Types

```{r}
manual_pct <- round(sum(data$am == "Manual") / nrow(data) * 100, 1)
valueBox(
  paste0(manual_pct, "%"),
  icon = "fa-cog",
  color = "info",
  caption = "Manual Transmission"
)
```

### Summary Statistics

```{r}
summary_stats <- data %>%
  select(mpg, hp, wt, qsec) %>%
  summarise(
    across(everything(),
           list(mean = ~round(mean(.), 2),
                sd = ~round(sd(.), 2)),
           .names = "{.col}_{.fn}")
  ) %>%
  pivot_longer(everything(), names_to = "Statistic", values_to = "Value")

knitr::kable(summary_stats)
```

## Column {data-width=700}

### Distribution of Miles Per Gallon

```{r}
p1 <- ggplot(data, aes(x = mpg, fill = am)) +
  geom_histogram(bins = 15, alpha = 0.7, position = "identity") +
  scale_fill_viridis_d() +
  theme_minimal() +
  labs(x = "Miles Per Gallon", y = "Frequency", fill = "Transmission")

ggplotly(p1)
```

### MPG by Transmission Type

```{r}
p2 <- ggplot(data, aes(x = am, y = mpg, fill = am)) +
  geom_boxplot(alpha = 0.7) +
  scale_fill_viridis_d() +
  theme_minimal() +
  labs(x = "Transmission Type", y = "Miles Per Gallon") +
  theme(legend.position = "none")

ggplotly(p2)
```

# Relationships

## Column {data-width=500}

### Weight vs MPG

```{r}
p3 <- ggplot(data, aes(x = wt, y = mpg, color = cyl, text = car_name)) +
  geom_point(size = 3) +
  geom_smooth(method = "lm", se = FALSE, color = "gray40") +
  scale_color_viridis_d() +
  theme_minimal() +
  labs(x = "Weight (1000 lbs)", y = "Miles Per Gallon", color = "Cylinders")

ggplotly(p3, tooltip = c("text", "x", "y"))
```

### Horsepower vs MPG

```{r}
p4 <- ggplot(data, aes(x = hp, y = mpg, color = am, text = car_name)) +
  geom_point(size = 3) +
  scale_color_viridis_d() +
  theme_minimal() +
  labs(x = "Horsepower", y = "Miles Per Gallon", color = "Transmission")

ggplotly(p4, tooltip = c("text", "x", "y"))
```

## Column {data-width=500}

### Performance by Cylinders

```{r}
p5 <- data %>%
  group_by(cyl) %>%
  summarise(
    avg_mpg = mean(mpg),
    avg_hp = mean(hp),
    count = n()
  ) %>%
  ggplot(aes(x = cyl, y = avg_mpg, fill = cyl)) +
  geom_col(alpha = 0.8) +
  geom_text(aes(label = round(avg_mpg, 1)), vjust = -0.5) +
  scale_fill_viridis_d() +
  theme_minimal() +
  labs(x = "Number of Cylinders", y = "Average MPG") +
  theme(legend.position = "none")

ggplotly(p5)
```

### Correlation Heatmap

```{r}
cor_data <- data %>%
  select(mpg, cyl, disp, hp, drat, wt, qsec) %>%
  mutate(cyl = as.numeric(as.character(cyl))) %>%
  cor()

plot_ly(
  x = colnames(cor_data),
  y = colnames(cor_data),
  z = cor_data,
  type = "heatmap",
  colors = viridis(100)
) %>%
  layout(
    xaxis = list(title = ""),
    yaxis = list(title = "")
  )
```

# Data Table

## Column {data-width=1000}

### Interactive Data Table

```{r}
datatable(
  data,
  filter = "top",
  options = list(
    pageLength = 15,
    scrollX = TRUE,
    autoWidth = TRUE
  ),
  rownames = FALSE
) %>%
  formatRound(columns = c("mpg", "wt", "qsec"), digits = 2)
```
